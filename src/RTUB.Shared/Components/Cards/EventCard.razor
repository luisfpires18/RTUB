@namespace RTUB.Shared
@*
    EventCard Component
    Reusable card for displaying event information with enrollment actions
*@

<div class="card event-card h-100">
    <div class="position-relative">
        @if (!string.IsNullOrEmpty(Event.ImageSrc))
        {
            <img src="@Event.ImageSrc" class="card-img-top event-image" alt="@Event.Name">
        }
        else
        {
            <div class="card-img-top event-image-placeholder">
                <i class="bi bi-calendar-event music-icon-large"></i>
            </div>
        }
        @if (IsAdmin)
        {
            <div class="admin-overlay">
                <button class="btn btn-sm music-btn-edit" 
                        @onclick="OnEdit" 
                        title="Editar evento">
                    <i class="bi bi-pencil music-icon-edit"></i>
                </button>
                <button class="btn btn-sm music-btn-delete" 
                        @onclick="OnDelete" 
                        title="Eliminar evento">
                    <i class="bi bi-trash music-icon-delete"></i>
                </button>
            </div>
        }
    </div>
    <div class="card-body d-flex flex-column p-3">
        <h5 class="card-title mb-2">@Event.Name</h5>
        <p class="card-text text-light-theme mb-2">
            <small>
                <i class="bi bi-calendar me-1"></i>
                @if (Event.EndDate.HasValue && Event.EndDate.Value.Date != Event.Date.Date)
                {
                    <span>@Event.Date.ToString("dd MMM") - @Event.EndDate.Value.ToString("dd MMM yyyy")</span>
                }
                else
                {
                    <span>@Event.Date.ToString("dd MMM yyyy")</span>
                }
            </small>
        </p>
        @if (!string.IsNullOrEmpty(Event.Location))
        {
            <p class="card-text text-light-theme mb-2">
                <small>
                    <i class="bi bi-geo-alt me-1"></i> @Event.Location
                </small>
            </p>
        }
        @if (!string.IsNullOrEmpty(Event.Description))
        {
            <p class="card-text flex-grow-1 mb-2">@Event.Description</p>
        }

        @if (!IsPastEvent)
        {
            <div class="enrollment-section mt-auto p-2 rounded">
                <div class="d-flex gap-2 align-items-center justify-content-center flex-wrap">
                    <!-- View Enrollments button -->
                    <button class="btn btn-sm btn-outline-secondary d-flex align-items-center gap-1" 
                            @onclick="OnViewEnrollments" 
                            title="Ver Inscrições">
                        <i class="bi bi-people icon-size-1rem"></i>
                        <span>@EnrollmentCount</span>
                    </button>

                    <!-- Watch Repertoire button -->
                    <button class="btn btn-sm btn-outline-primary d-flex align-items-center" 
                            @onclick="OnWatchRepertoire" 
                            title="Ver Repertório">
                        <i class="bi bi-music-note-list icon-size-1rem"></i>
                    </button>

                    @if (UserEnrollment == null)
                    {
                        <!-- Enroll button -->
                        <button class="btn btn-sm btn-purple d-flex align-items-center gap-1" 
                                @onclick="OnEnroll" 
                                title="Inscrever neste evento">
                            <i class="bi bi-plus-circle-fill icon-size-1rem"></i>
                            <span class="d-none d-sm-inline">Inscrever</span>
                        </button>
                    }
                    else
                    {
                        <!-- Enrolled status button (disabled, purple) -->
                        <button class="btn btn-sm btn-purple d-flex align-items-center gap-1" 
                                disabled 
                                title="Inscrito">
                            <i class="bi bi-check-circle-fill icon-size-1rem"></i>
                            <span class="d-none d-md-inline">Inscrito</span>
                        </button>
                        
                        <!-- Edit enrollment button (white) -->
                        <button class="btn btn-sm btn-light d-flex align-items-center" 
                                @onclick="OnEditEnrollment" 
                                title="Editar Inscrição">
                            <i class="bi bi-pencil-fill icon-size-1rem"></i>
                        </button>
                        
                        <!-- Remove enrollment button (red) -->
                        <button class="btn btn-sm btn-danger d-flex align-items-center" 
                                @onclick="OnRemoveEnrollment" 
                                title="Anular Inscrição">
                            <i class="bi bi-x-circle-fill icon-size-1rem"></i>
                        </button>
                    }
                </div>
            </div>
        }
    </div>
</div>

@code {
    /// <summary>
    /// The event to display
    /// </summary>
    [Parameter]
    public Event Event { get; set; } = null!;

    /// <summary>
    /// The current user's enrollment for this event (if any)
    /// </summary>
    [Parameter]
    public Enrollment? UserEnrollment { get; set; }

    /// <summary>
    /// Total number of enrollments for this event
    /// </summary>
    [Parameter]
    public int EnrollmentCount { get; set; }

    /// <summary>
    /// Whether the current user has admin privileges
    /// </summary>
    [Parameter]
    public bool IsAdmin { get; set; }

    /// <summary>
    /// Whether this is a past event (changes display behavior)
    /// </summary>
    [Parameter]
    public bool IsPastEvent { get; set; }

    /// <summary>
    /// Callback when the edit button is clicked
    /// </summary>
    [Parameter]
    public EventCallback OnEdit { get; set; }

    /// <summary>
    /// Callback when the delete button is clicked
    /// </summary>
    [Parameter]
    public EventCallback OnDelete { get; set; }

    /// <summary>
    /// Callback when the enroll button is clicked
    /// </summary>
    [Parameter]
    public EventCallback OnEnroll { get; set; }

    /// <summary>
    /// Callback when the view enrollments button is clicked
    /// </summary>
    [Parameter]
    public EventCallback OnViewEnrollments { get; set; }

    /// <summary>
    /// Callback when the edit enrollment button is clicked
    /// </summary>
    [Parameter]
    public EventCallback OnEditEnrollment { get; set; }

    /// <summary>
    /// Callback when the remove enrollment button is clicked
    /// </summary>
    [Parameter]
    public EventCallback OnRemoveEnrollment { get; set; }

    /// <summary>
    /// Callback when the watch repertoire button is clicked
    /// </summary>
    [Parameter]
    public EventCallback OnWatchRepertoire { get; set; }
}
