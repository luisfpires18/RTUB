@namespace RTUB.Shared
@using RTUB.Core.Entities
@using RTUB.Core.Enums
@*
    InstrumentCircle Component
    Displays instrument information in a circular card format
    Similar to AvatarCard but specialized for instruments
*@

<div class="instrument-circle">
    <!-- Edit & Delete buttons in top-right -->
    @if (ShowEditButton)
    {
        <button class="instrument-circle-edit-btn" 
                @onclick="@OnEdit" 
                @onclick:stopPropagation="true"
                title="@EditTooltip"
                aria-label="@EditTooltip">
            <i class="bi bi-pencil"></i>
        </button>
    }
    @if (ShowDeleteButton)
    {
        <button class="instrument-circle-delete-btn" 
                @onclick="@OnDelete" 
                @onclick:stopPropagation="true"
                title="@DeleteTooltip"
                aria-label="@DeleteTooltip">
            <i class="bi bi-trash"></i>
        </button>
    }

    <!-- Circular Image/Icon -->
    <div class="instrument-circle-image-wrapper">
        @if (Instrument.ImageData != null && Instrument.ImageData.Length > 0)
        {
            <img src="@ImageUrl" 
                 alt="@Instrument.Name" 
                 class="instrument-circle-image"
                 loading="lazy" />
        }
        else
        {
            <div class="instrument-circle-placeholder">
                <i class="bi bi-music-note-beamed instrument-icon-large"></i>
            </div>
        }
    </div>

    <!-- Instrument Info -->
    <div class="instrument-circle-content">
        <!-- Name -->
        <div class="instrument-circle-name">@Instrument.Name</div>
        
        <!-- Category -->
        <div class="instrument-circle-badges">
            <span class="badge bg-primary">@Instrument.Category</span>
            <span class="badge @GetConditionBadgeClass(Instrument.Condition)">
                @GetConditionDisplayName(Instrument.Condition)
            </span>
        </div>

        <!-- Additional Info -->
        @if (!string.IsNullOrEmpty(Instrument.Brand))
        {
            <div class="instrument-circle-detail">
                <strong>Marca:</strong> @Instrument.Brand
            </div>
        }
        @if (!string.IsNullOrEmpty(Instrument.Location))
        {
            <div class="instrument-circle-detail">
                <strong>Local:</strong> @Instrument.Location
            </div>
        }
    </div>

    <!-- View button below the card -->
    @if (ShowViewButton)
    {
        <div class="instrument-circle-actions">
            <button class="btn btn-sm btn-purple w-100" 
                    @onclick="@OnView"
                    title="@ViewTooltip"
                    aria-label="@ViewTooltip">
                <i class="bi bi-eye"></i> @ViewButtonText
            </button>
        </div>
    }
</div>

@code {
    [Parameter]
    public Instrument Instrument { get; set; } = null!;

    [Parameter]
    public string ImageUrl { get; set; } = string.Empty;

    [Parameter]
    public EventCallback OnView { get; set; }

    [Parameter]
    public EventCallback OnEdit { get; set; }

    [Parameter]
    public EventCallback OnDelete { get; set; }

    [Parameter]
    public bool ShowViewButton { get; set; } = false;

    [Parameter]
    public bool ShowEditButton { get; set; } = false;

    [Parameter]
    public bool ShowDeleteButton { get; set; } = false;

    [Parameter]
    public string ViewTooltip { get; set; } = "Ver Detalhes";

    [Parameter]
    public string ViewButtonText { get; set; } = "Ver Detalhes";

    [Parameter]
    public string EditTooltip { get; set; } = "Editar";

    [Parameter]
    public string DeleteTooltip { get; set; } = "Eliminar";

    private string GetConditionDisplayName(InstrumentCondition condition)
    {
        return condition switch
        {
            InstrumentCondition.Excellent => "Óptimo",
            InstrumentCondition.Good => "Bom",
            InstrumentCondition.Worn => "Velho",
            InstrumentCondition.NeedsMaintenance => "Precisa Manutenção",
            _ => condition.ToString()
        };
    }

    private string GetConditionBadgeClass(InstrumentCondition condition)
    {
        return condition switch
        {
            InstrumentCondition.Excellent => "bg-success",
            InstrumentCondition.Good => "bg-info",
            InstrumentCondition.Worn => "bg-warning",
            InstrumentCondition.NeedsMaintenance => "bg-danger",
            _ => "bg-secondary"
        };
    }
}
