@namespace RTUB.Shared
@*
    Reusable pagination component
    Provides consistent pagination UI with page size selector
*@

<div class="pagination-container">
    <!-- Pagination Controls -->
    @if (TotalPages > 1)
    {
        <nav aria-label="Table pagination">
            <ul class="pagination justify-content-center">
                <li class="page-item @(!HasPreviousPage ? "disabled" : "")">
                    <button class="page-link" @onclick="PreviousPage" disabled="@(!HasPreviousPage)">
                        Anterior
                    </button>
                </li>
                
                @if (TotalPages <= 7)
                {
                    @* Show all pages if 7 or fewer *@
                    @for (int i = 1; i <= TotalPages; i++)
                    {
                        var pageNum = i;
                        <li class="page-item @(CurrentPage == pageNum ? "active" : "")">
                            <button class="page-link" @onclick="() => GoToPage(pageNum)">@pageNum</button>
                        </li>
                    }
                }
                else
                {
                    @* Show abbreviated pagination for many pages *@
                    <li class="page-item @(CurrentPage == 1 ? "active" : "")">
                        <button class="page-link" @onclick="() => GoToPage(1)">1</button>
                    </li>

                    @if (CurrentPage > 3)
                    {
                        <li class="page-item disabled">
                            <span class="page-link">...</span>
                        </li>
                    }

                    @for (int i = Math.Max(2, CurrentPage - 1); i <= Math.Min(TotalPages - 1, CurrentPage + 1); i++)
                    {
                        var pageNum = i;
                        <li class="page-item @(CurrentPage == pageNum ? "active" : "")">
                            <button class="page-link" @onclick="() => GoToPage(pageNum)">@pageNum</button>
                        </li>
                    }

                    @if (CurrentPage < TotalPages - 2)
                    {
                        <li class="page-item disabled">
                            <span class="page-link">...</span>
                        </li>
                    }

                    <li class="page-item @(CurrentPage == TotalPages ? "active" : "")">
                        <button class="page-link" @onclick="() => GoToPage(TotalPages)">@TotalPages</button>
                    </li>
                }

                <li class="page-item @(!HasNextPage ? "disabled" : "")">
                    <button class="page-link" @onclick="NextPage" disabled="@(!HasNextPage)">
                        Próximo
                    </button>
                </li>
            </ul>
        </nav>
    }

    <!-- Item Count and Page Size -->
    <div class="pagination-info">
        <div class="d-flex justify-content-between align-items-center flex-wrap">
            <div class="text-center text-md-start mb-2 mb-md-0">
                <span class="pagination-info-text">
                    Mostrando @StartItemNumber-@EndItemNumber de @TotalItems @ItemLabel
                </span>
            </div>
            <div class="text-center text-md-end">
                <label class="me-2 pagination-info-label">Itens por página:</label>
                <select class="form-select form-select-sm d-inline-block w-auto" 
                        value="@PageSize" 
                        @onchange="HandlePageSizeChange">
                    @foreach (var size in PageSizeOptions)
                    {
                        <option value="@size">@size</option>
                    }
                </select>
            </div>
        </div>
    </div>
</div>

@code {
    /// <summary>
    /// Current page number (1-based)
    /// </summary>
    [Parameter]
    public int CurrentPage { get; set; } = 1;

    /// <summary>
    /// Number of items per page
    /// </summary>
    [Parameter]
    public int PageSize { get; set; } = 25;

    /// <summary>
    /// Total number of items
    /// </summary>
    [Parameter]
    public int TotalItems { get; set; }

    /// <summary>
    /// Label for items (e.g., "items", "eventos", "membros")
    /// </summary>
    [Parameter]
    public string ItemLabel { get; set; } = "itens";

    /// <summary>
    /// Callback when page is changed
    /// </summary>
    [Parameter]
    public EventCallback<int> OnPageChanged { get; set; }

    /// <summary>
    /// Callback when page size is changed
    /// </summary>
    [Parameter]
    public EventCallback<int> OnPageSizeChanged { get; set; }

    /// <summary>
    /// Page size options to display in the dropdown. Defaults to standard sizes.
    /// </summary>
    [Parameter]
    public int[] PageSizeOptions { get; set; } = new[] { 10, 25, 50, 100 };

    private int TotalPages => TotalItems > 0 ? (int)Math.Ceiling((double)TotalItems / PageSize) : 1;
    private bool HasPreviousPage => CurrentPage > 1;
    private bool HasNextPage => CurrentPage < TotalPages;
    private int StartItemNumber => TotalItems == 0 ? 0 : ((CurrentPage - 1) * PageSize) + 1;
    private int EndItemNumber => Math.Min(CurrentPage * PageSize, TotalItems);

    private async Task GoToPage(int page)
    {
        if (page >= 1 && page <= TotalPages && page != CurrentPage)
        {
            if (OnPageChanged.HasDelegate)
            {
                await OnPageChanged.InvokeAsync(page);
            }
        }
    }

    private async Task PreviousPage()
    {
        if (HasPreviousPage)
        {
            await GoToPage(CurrentPage - 1);
        }
    }

    private async Task NextPage()
    {
        if (HasNextPage)
        {
            await GoToPage(CurrentPage + 1);
        }
    }

    private async Task HandlePageSizeChange(ChangeEventArgs e)
    {
        if (int.TryParse(e.Value?.ToString(), out int newSize))
        {
            if (OnPageSizeChanged.HasDelegate)
            {
                await OnPageSizeChanged.InvokeAsync(newSize);
            }
        }
    }
}
