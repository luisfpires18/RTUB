@namespace RTUB.Shared

@*
    FormSelect Component
    Modern select dropdown with optional icon, following DetailsModal and Profile design patterns
*@

<div class="form-group @CssClass">
    @if (!string.IsNullOrEmpty(Label))
    {
        <label class="form-label fw-semibold @LabelCssClass">
            @if (!string.IsNullOrEmpty(Icon))
            {
                <i class="bi bi-@Icon text-primary me-2"></i>
            }
            @Label
            @if (Required)
            {
                <span class="text-danger ms-1">*</span>
            }
        </label>
    }
    <select class="form-select @InputCssClass" 
            value="@Value" 
            @onchange="OnValueChanged"
            disabled="@Disabled">
        @if (!string.IsNullOrEmpty(DefaultOption))
        {
            <option value="">@DefaultOption</option>
        }
        @ChildContent
    </select>
    @if (!string.IsNullOrEmpty(HelpText))
    {
        <small class="form-text text-muted mt-1 d-block">@HelpText</small>
    }
</div>

@code {
    /// <summary>
    /// Label text for the select field
    /// </summary>
    [Parameter]
    public string Label { get; set; } = string.Empty;

    /// <summary>
    /// Bootstrap icon class name (without "bi-" prefix, e.g., "list-ul")
    /// </summary>
    [Parameter]
    public string? Icon { get; set; }

    /// <summary>
    /// Current value of the select
    /// </summary>
    [Parameter]
    public string? Value { get; set; }

    /// <summary>
    /// Event callback when value changes
    /// </summary>
    [Parameter]
    public EventCallback<string?> ValueChanged { get; set; }

    /// <summary>
    /// Default option text (e.g., "Select an option...")
    /// </summary>
    [Parameter]
    public string? DefaultOption { get; set; }

    /// <summary>
    /// Whether the field is required
    /// </summary>
    [Parameter]
    public bool Required { get; set; }

    /// <summary>
    /// Whether the field is disabled
    /// </summary>
    [Parameter]
    public bool Disabled { get; set; }

    /// <summary>
    /// Help text displayed below the select
    /// </summary>
    [Parameter]
    public string? HelpText { get; set; }

    /// <summary>
    /// Additional CSS classes for the form group
    /// </summary>
    [Parameter]
    public string CssClass { get; set; } = string.Empty;

    /// <summary>
    /// Additional CSS classes for the label
    /// </summary>
    [Parameter]
    public string LabelCssClass { get; set; } = string.Empty;

    /// <summary>
    /// Additional CSS classes for the select
    /// </summary>
    [Parameter]
    public string InputCssClass { get; set; } = string.Empty;

    /// <summary>
    /// Options content (option elements)
    /// </summary>
    [Parameter]
    public RenderFragment? ChildContent { get; set; }

    private async Task OnValueChanged(ChangeEventArgs e)
    {
        Value = e.Value?.ToString();
        await ValueChanged.InvokeAsync(Value);
    }
}
